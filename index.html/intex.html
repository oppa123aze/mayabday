<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Happy Birthday Maya üéâ</title>
  <link rel="stylesheet" href="../style.css/style.css">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: "Poppins", sans-serif;
      color: white;
      text-align: center;
    }
    /* Fixed background image overlay (none now) */
    #bg-video {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: -1;
      filter: brightness(0.6) saturate(1.2);
      transition: filter 0.3s ease;
      background: #000;
    }
    
    #bg-video:hover {
      filter: brightness(0.8) saturate(1.4);
    }
    
    /* Fallback background in case video doesn't load */
    body {
      background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
      background-attachment: fixed;
    }
    .overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100vw;
      z-index: 1;
    }
    h1 {
      font-size: 3em;
      text-shadow: 2px 2px 10px #000;
    }
    p {
      font-size: 1.5em;
      margin-top: 10px;
      text-shadow: 1px 1px 8px #000;
    }
    button {
      margin-top: 20px;
      padding: 15px 30px;
      border: none;
      border-radius: 25px;
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
      color: white;
      font-size: 1.2em;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
      background: linear-gradient(45deg, #ff5252, #26a69a);
    }
    button:active {
      transform: translateY(0);
    }

    /* Focus mode hides UI, keeps background/media running */
    body.focus-mode .overlay { display: none; }
    body.focus-mode #countdown { display: none; }
    
    /* Focus mode button - small corner button */
    #focus-mode {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(0,0,0,0.3);
      border: 2px solid rgba(255,255,255,0.3);
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    #focus-mode:hover {
      background: rgba(0,0,0,0.6);
      border-color: rgba(255,255,255,0.6);
      transform: scale(1.1);
    }
    
    /* Mobile optimizations */
    @media (max-width: 768px) {
      h1 {
        font-size: 2.2em !important;
        margin: 10px 0;
      }
      p {
        font-size: 1.2em !important;
        margin: 8px 0;
      }
      button {
        padding: 12px 20px !important;
        font-size: 1em !important;
        margin: 8px !important;
      }
      .messages textarea {
        width: 95vw !important;
        height: 100px !important;
        font-size: 16px !important; /* Prevents zoom on iOS */
      }
      #countdown {
        top: 8px;
        left: 8px;
        padding: 4px 8px;
      }
      #countdown .flip {
        min-width: 35px;
        margin: 0 2px;
        padding: 3px 5px;
        font-size: 12px;
      }
      #countdown .label {
        font-size: 8px;
      }
      #focus-mode {
        width: 35px;
        height: 35px;
        font-size: 14px;
        top: 15px;
        right: 15px;
      }
    }

    /* Portrait removed */

    /* Countdown (top-left) with green smooth animation - extra small */
    #countdown {
      position: fixed;
      top: 12px;
      left: 12px;
      z-index: 2;
      background: linear-gradient(135deg, rgba(0,100,0,0.8), rgba(0,150,0,0.6));
      padding: 6px 10px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,100,0,0.4);
      perspective: 600px;
      transform-style: preserve-3d;
      border: 2px solid rgba(0,255,0,0.3);
      backdrop-filter: blur(10px);
    }
    #countdown .flip {
      display: inline-block;
      min-width: 45px;
      margin: 0 3px;
      padding: 4px 6px;
      background: linear-gradient(135deg, rgba(0,80,0,0.9), rgba(0,120,0,0.7));
      border-radius: 8px;
      transform: rotateY(0deg);
      animation: smoothFlip 3s infinite ease-in-out;
      box-shadow: inset 0 0 12px rgba(0,200,0,0.2), 0 4px 12px rgba(0,100,0,0.4);
      border: 1px solid rgba(0,255,0,0.2);
    }
    #countdown .label {
      display: block;
      font-size: 10px;
      opacity: 0.9;
      color: #90EE90;
      font-weight: bold;
    }
    #countdown .flip span {
      color: #00FF00;
      font-weight: bold;
      text-shadow: 0 0 10px rgba(0,255,0,0.5);
    }
    @keyframes smoothFlip {
      0%, 100% { 
        transform: rotateY(0deg) scale(1);
        box-shadow: inset 0 0 20px rgba(0,200,0,0.2), 0 8px 20px rgba(0,100,0,0.4);
      }
      50% { 
        transform: rotateY(15deg) scale(1.05);
        box-shadow: inset 0 0 30px rgba(0,255,0,0.3), 0 12px 25px rgba(0,150,0,0.5);
      }
    }

    /* Messages section */
    .messages {
      position: relative;
      z-index: 1;
      margin-top: 24px;
    }
    .messages .locked-note {
      margin-top: 8px;
      font-size: 0.95em;
      opacity: 0.9;
    }
    .messages textarea {
      width: min(90vw, 600px);
      height: 120px;
      resize: vertical;
      border: none;
      border-radius: 10px;
      padding: 12px;
      outline: none;
      background: rgba(255,255,255,0.15);
      color: #fff;
      box-shadow: 0 6px 16px rgba(0,0,0,0.35);
      backdrop-filter: blur(6px);
    }
    .messages button {
      margin-top: 12px;
    }
    .messages .count {
      margin-top: 10px;
      font-size: 0.95em;
      opacity: 0.95;
    }
  </style>
</head>
<body>

  <!-- Top-left countdown -->
  <div id="countdown">
    <span class="flip"><span id="cd-days">00</span><span class="label">Days</span></span>
    <span class="flip"><span id="cd-hours">00</span><span class="label">Hours</span></span>
    <span class="flip"><span id="cd-mins">00</span><span class="label">Minutes</span></span>
    <span class="flip"><span id="cd-secs">00</span><span class="label">Seconds</span></span>
  </div>

  <!-- Focus Mode button - top right corner -->
  <button id="focus-mode" onclick="toggleFocusMode()" title="Focus Mode">üßò‚Äç‚ôÄÔ∏è</button>

  <!-- Video background with optimized loading - only 3 videos -->
  <video autoplay muted loop id="bg-video" playsinline preload="metadata">
    <source src="../videos/bgvideo.mp4.mp4" type="video/mp4">
    <source src="../videos/aesthetic-night-sky-and-stars-moewalls-com.mp4" type="video/mp4">
    <source src="../videos/pink-clouds-shooting-stars-moewalls-com.mp4" type="video/mp4">
    Your browser does not support video.
  </video>

  <!-- Music with optimized loading - only 1 song -->
  <audio id="bg-music" loop preload="metadata">
    <source src="../songs/birthday.mp3.mp3" type="audio/mpeg">
  </audio>

  <!-- Overlay -->
  <div class="overlay">
    <h1>Happy Birthday Maya üéâüíö</h1>
    <p id="subtitle" style="color:#32cd32">Fair soul, thy heart shines bright like emerald light ‚≠ê</p>
    <button onclick="playMusic()">Play Music üé∂</button>
    <button id="next-song" onclick="nextSong()">Next Song ‚è≠Ô∏è</button>

    <!-- Messages box (unlocks on birthday) -->
    <div class="messages">
      <textarea id="message-input" placeholder="Write a message to Maya..."></textarea>
      <div>
        <button id="submit-message" onclick="submitMessage()" type="button">Send Message üíå</button>
      </div>
      <div id="locked-note" class="locked-note">Write a message to see it next birthday! üíå</div>
      <div class="count">Messages collected: <span id="messages-count">0</span></div>
    </div>
  </div>

  <script>
    const music = document.getElementById("bg-music");
    const video = document.getElementById("bg-video");
    const nextSongBtn = document.getElementById('next-song');
    const messageInput = document.getElementById('message-input');
    const submitMessageBtn = document.getElementById('submit-message');
    const focusModeBtn = document.getElementById('focus-mode');
    const messagesCountEl = document.getElementById('messages-count');
    let isPlaying = false;

    // Media playlists - optimized for smaller file size
    const videoPaths = [
      '../videos/bgvideo.mp4.mp4',
      '../videos/aesthetic-night-sky-and-stars-moewalls-com.mp4',
      '../videos/pink-clouds-shooting-stars-moewalls-com.mp4'
      // Only 3 videos to reduce file size significantly
    ].filter(Boolean);
    const songPaths = [
      '../songs/birthday.mp3.mp3'
      // Only 1 song to reduce file size
    ];
    let currentVideoIndex = 0;
    let currentSongIndex = 0;
    let clickCount = 0;

    // Ensure video plays on load with lazy loading
    window.addEventListener('load', function() {
      console.log("Page loaded, attempting to play video...");
      // Initialize media sources with lazy loading
      setVideo(currentVideoIndex);
      setSong(currentSongIndex, /*autoplay*/ false);
      
      // Lazy load video - only load when needed
      video.addEventListener('canplay', function() {
        video.play().catch(err => {
          console.log("Video autoplay prevented:", err);
          // Try to play on user interaction
          document.addEventListener('click', function() {
            video.play().catch(e => console.log("Still can't play video:", e));
          }, { once: true });
        });
      });
      
      // Init countdown and messages
      loadMessages();
      updateCountdownAndLock();
      setInterval(updateCountdownAndLock, 1000);
      
      // Add event listener to submit button as backup
      const submitBtn = document.getElementById('submit-message');
      if (submitBtn) {
        submitBtn.addEventListener('click', function(e) {
          e.preventDefault();
          console.log('Submit button clicked via event listener');
          submitMessage();
        });
      }
    });

    // Debug video loading
    video.addEventListener('loadstart', () => console.log("Video loading started"));
    video.addEventListener('loadeddata', () => console.log("Video data loaded"));
    video.addEventListener('canplay', () => console.log("Video can play"));
    video.addEventListener('error', (e) => console.log("Video error:", e));

    // Debug audio loading
    music.addEventListener('loadstart', () => console.log("Audio loading started"));
    music.addEventListener('loadeddata', () => console.log("Audio data loaded"));
    music.addEventListener('canplay', () => console.log("Audio can play"));
    music.addEventListener('error', (e) => console.log("Audio error:", e));

    function playMusic() {
      console.log("Play music button clicked, isPlaying:", isPlaying);
      if (!isPlaying) {
        music.volume = 0.6; // Set volume
        console.log("Attempting to play audio...");
        music.play().then(() => {
          console.log("Audio playing successfully");
          isPlaying = true;
          document.querySelector('button').textContent = 'Pause Music ‚è∏Ô∏è';
        }).catch(err => {
          console.log("Audio play error:", err);
          alert("Click the button to play music! Error: " + err.message);
        });
      } else {
        console.log("Pausing audio");
        music.pause();
        isPlaying = false;
        document.querySelector('button').textContent = 'Play Music üé∂';
      }
    }

    function nextSong() {
      currentSongIndex = (currentSongIndex + 1) % songPaths.length;
      const shouldAutoplay = isPlaying;
      setSong(currentSongIndex, shouldAutoplay);
    }

    function setSong(index, autoplay) {
      music.src = songPaths[index];
      music.load();
      if (autoplay) {
        music.play().catch(err => console.log('Autoplay prevented on song change:', err));
      }
    }

    function setVideo(index) {
      video.src = videoPaths[index];
      video.load();
      video.play().catch(err => console.log('Video play prevented on change:', err));
    }

    function toggleFocusMode() {
      const currentlyFocused = document.body.classList.contains('focus-mode');
      
      if (!currentlyFocused) {
        // Enter focus mode
        document.body.classList.add('focus-mode');
        if (focusModeBtn) focusModeBtn.textContent = 'üßò‚Äç‚ôÄÔ∏è';
        console.log('Entered focus mode');
      } else {
        // Exit focus mode
        document.body.classList.remove('focus-mode');
        if (focusModeBtn) focusModeBtn.textContent = 'üßò‚Äç‚ôÄÔ∏è';
        console.log('Exited focus mode');
      }
    }

    // Add some interactive effects + count clicks (mobile optimized)
    document.addEventListener('click', function(e) {
      if (e.target.tagName !== 'BUTTON') {
        // Ripple
        const ripple = document.createElement('div');
        ripple.style.position = 'fixed';
        ripple.style.borderRadius = '50%';
        ripple.style.background = 'rgba(255, 255, 255, 0.3)';
        ripple.style.transform = 'scale(0)';
        ripple.style.animation = 'ripple 0.6s linear';
        ripple.style.left = e.clientX - 10 + 'px';
        ripple.style.top = e.clientY - 10 + 'px';
        ripple.style.width = '20px';
        ripple.style.height = '20px';
        ripple.style.pointerEvents = 'none';
        document.body.appendChild(ripple);
        setTimeout(() => { document.body.removeChild(ripple); }, 600);

        // Count and rotate every 3 clicks (video only, no music change)
        clickCount++;
        if (clickCount % 3 === 0) {
          currentVideoIndex = (currentVideoIndex + 1) % videoPaths.length;
          setVideo(currentVideoIndex);
        }
      }
    });

    // Mobile touch events for better responsiveness
    document.addEventListener('touchstart', function(e) {
      if (e.target.tagName !== 'BUTTON') {
        // Count and rotate every 3 touches (video only, no music change)
        clickCount++;
        if (clickCount % 3 === 0) {
          currentVideoIndex = (currentVideoIndex + 1) % videoPaths.length;
          setVideo(currentVideoIndex);
        }
      }
    }, { passive: true });

    // Countdown to 10 September (next occurrence)
    function getNextBirthday() {
      const now = new Date();
      const year = now.getMonth() > 8 || (now.getMonth() === 8 && now.getDate() >= 10) ? now.getFullYear() + 1 : now.getFullYear();
      // Months are 0-indexed; September is 8
      return new Date(year, 8, 10, 0, 0, 0, 0);
    }

    function updateCountdownAndLock() {
      const target = getNextBirthday();
      const now = new Date();
      const diff = target - now;
      const d = Math.max(0, Math.floor(diff / (1000 * 60 * 60 * 24)));
      const h = Math.max(0, Math.floor((diff / (1000 * 60 * 60)) % 24));
      const m = Math.max(0, Math.floor((diff / (1000 * 60)) % 60));
      const s = Math.max(0, Math.floor((diff / 1000) % 60));
      setText('cd-days', d);
      setText('cd-hours', String(h).padStart(2,'0'));
      setText('cd-mins', String(m).padStart(2,'0'));
      setText('cd-secs', String(s).padStart(2,'0'));
    }

    function setText(id, value) {
      const el = document.getElementById(id);
      if (el) el.textContent = value;
    }

    function loadMessages() {
      const raw = localStorage.getItem('mayaMessages');
      let arr = [];
      try { arr = raw ? JSON.parse(raw) : []; } catch { arr = []; }
      messagesCountEl.textContent = arr.length;
    }

    function isMayaBirthday() {
      const now = new Date();
      return now.getMonth() === 8 && now.getDate() === 10; // September 10th
    }

    function submitMessage() {
      console.log('Send message clicked');
      
      const text = (messageInput.value || '').trim();
      console.log('Message text:', text);
      
      if (!text) {
        alert('Please write a message first!');
        return;
      }
      
      // Show loading state
      const submitBtn = document.getElementById('submit-message');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Sending...';
      submitBtn.disabled = true;
      
      // Send to Formspree
      const formData = new FormData();
      formData.append('message', text);
      formData.append('timestamp', new Date().toLocaleString());
      formData.append('date', new Date().toISOString().split('T')[0]);
      formData.append('email', 'bjjmayamayabjj@gmail.com');
      
      fetch('https://formspree.io/f/xyzdojgj', {
        method: 'POST',
        body: formData,
        headers: {
          'Accept': 'application/json'
        }
      })
      .then(response => {
        if (response.ok) {
          console.log('Message sent to Formspree successfully');
          // Show success popup
          showMessagePopup('‚úÖ Message sent successfully! Maya will receive it in her email.', 'success');
        } else {
          console.log('Formspree error:', response.status);
          showMessagePopup('‚ùå Failed to send message. Please try again.', 'error');
        }
      })
      .catch(error => {
        console.log('Formspree error:', error);
        showMessagePopup('‚ùå Network error. Please check your connection.', 'error');
      })
      .finally(() => {
        // Reset button
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        messageInput.value = '';
        
        // Update message count locally
        const raw = localStorage.getItem('mayaMessages');
        let arr = [];
        try { arr = raw ? JSON.parse(raw) : []; } catch { arr = []; }
        arr.push({
          id: Date.now(),
          text: text,
          timestamp: new Date().toLocaleString(),
          date: new Date().toISOString().split('T')[0]
        });
        localStorage.setItem('mayaMessages', JSON.stringify(arr));
        messagesCountEl.textContent = arr.length;
      });
    }
    
    function showMessagePopup(message, type) {
      // Create popup
      const popup = document.createElement('div');
      popup.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: ${type === 'success' ? 'linear-gradient(135deg, #4CAF50, #45a049)' : 'linear-gradient(135deg, #f44336, #d32f2f)'};
        color: white;
        padding: 20px 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        z-index: 10000;
        font-size: 16px;
        font-weight: bold;
        text-align: center;
        max-width: 400px;
        animation: popupSlide 0.3s ease-out;
      `;
      popup.textContent = message;
      
      // Add animation
      const style = document.createElement('style');
      style.textContent = `
        @keyframes popupSlide {
          from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
          to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
      `;
      document.head.appendChild(style);
      
      document.body.appendChild(popup);
      
      // Auto remove after 3 seconds
      setTimeout(() => {
        if (popup.parentNode) {
          popup.parentNode.removeChild(popup);
        }
        if (style.parentNode) {
          style.parentNode.removeChild(style);
        }
      }, 3000);
    }


  </script>

  <style>
    @keyframes ripple {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }
  </style>

</body>
</html>